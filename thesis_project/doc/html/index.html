<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Current Monitor API: Current Monitor API</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Current Monitor API
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">Documentation for current monitoring with PAC1720 sensors</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('index.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Current Monitor API </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This API enables configuration and data query on the PAC1720 current sensors. The main interface is the struct <a class="el" href="struct_p_a_c1720__device.html" title="Device interface, holding the configurations and measurements for each channel. ">PAC1720_device</a>. An instance of the struct must be provided to the init function of the API in order to configure the sensor. Once, the configuration settings are done the adapter module of the library needs to be initialized by the relavant function to enable bus communication. After initialization the measurements can be triggered and its results queried to get the actual measurement values. The actual current consumption, source voltage and power consumption of the measured device are available.</p>
<h1><a class="anchor" id="sec1"></a>
Driver initialization with settings from sensor</h1>
<p>The simple way for an initialization is a call of the function adapter_init_PAC1720_from_field. Here, the configuration stored in the struct instance is overwritten by the settings on the sensor. The values DEV_name_opt, CH_name_opt, DEV_sensor_address, CH_current_sense_resistor_value remain untouched. This is the simplest way to initialize the driver module since all settings are captured from the sensor and only three mandatory settings are rqeuired as shown below:</p>
<div class="fragment"><div class="line"><span class="comment">// Absolute minimum settings required for an initialization:</span></div><div class="line"><span class="keyword">struct </span><a class="code" href="struct_p_a_c1720__device.html">PAC1720_device</a> dev = </div><div class="line">{</div><div class="line">     .<a class="code" href="group__driver.html#ga381d1f2a3a83bef34d75f1fc11ce5985">DEV_sensor_address</a>                                     = 0x4F,</div><div class="line">     .DEV_CH1_conf.CH_current_sense_resistor_value           = 0.8f,</div><div class="line">     .DEV_CH2_conf.CH_current_sense_resistor_value           = 0.8f,</div><div class="line">};</div></div><!-- fragment --><ul>
<li></li>
</ul>
<h1><a class="anchor" id="sec2"></a>
Driver initialization with settings from struct instance</h1>
<p>The second possibility to initialize the driver module is to provide the struct instance at a call of the function adapter_init_PAC1720_user_defined. This function takes the configuration that is stored in the struct and initializes the sensor with it. Basically can the configuration be made with default values which are almost equal to zero within this context. To achive this, the struct is to be initialized accordingly. The setting of some values has to be different from zero to make the configuration default. The minimum required setting for this way of initialization is depicted in the minimum example. If the configuration of the sensor is to be further adjusted, all other settings can be made in the corresponding instance. The full configuration is shown in the large example. Note that all values are just samples and must be changed to your own needs.</p>
<div class="fragment"><div class="line">  <span class="comment">// Minimum settings required for an initialization:</span></div><div class="line">  <span class="keyword">struct </span><a class="code" href="struct_p_a_c1720__device.html">PAC1720_device</a> dev = </div><div class="line">  {</div><div class="line">   .<a class="code" href="group__driver.html#ga381d1f2a3a83bef34d75f1fc11ce5985">DEV_sensor_address</a>                                     = 0x4F,</div><div class="line">   .DEV_conversion_rate_reg                                = CONVERSION_DEFAULT,</div><div class="line">   .DEV_CH1_conf.CH_current_sense_resistor_value           = 0.8f,</div><div class="line">   .DEV_CH1_conf.CH_current_sense_sampling_time_reg        = CURRENT_SAMPLE_TIME_DEFAULT,</div><div class="line">   .DEV_CH1_conf.CH_current_sense_FSR_reg                  = CURRENT_SENSE_RANGE_DEFAULT,</div><div class="line">   .DEV_CH1_conf.CH_source_voltage_sampling_time_reg       = VSRC_SAMPLE_TIME_DEFAULT,</div><div class="line"> </div><div class="line">   .DEV_CH2_conf.CH_current_sense_resistor_value           = 0.8f,</div><div class="line">   .DEV_CH2_conf.CH_current_sense_sampling_time_reg        = CURRENT_SAMPLE_TIME_DEFAULT,</div><div class="line">   .DEV_CH2_conf.CH_current_sense_FSR_reg                  = CURRENT_SENSE_RANGE_DEFAULT,</div><div class="line">   .DEV_CH2_conf.CH_source_voltage_sampling_time_reg       = VSRC_SAMPLE_TIME_DEFAULT,</div><div class="line">  }; </div><div class="line"> </div><div class="line">  </div><div class="line">  <span class="comment">// All possible configuration settings:</span></div><div class="line">*<span class="keyword">struct </span><a class="code" href="struct_p_a_c1720__device.html">PAC1720_device</a> dev = </div><div class="line"> {</div><div class="line">   .<a class="code" href="group__driver.html#ga7c20db155a03b7bb3e6e9c8e73f6936d">DEV_name_opt</a>                                           = <span class="stringliteral">&quot;device_identifier&quot;</span>,</div><div class="line">   .DEV_sensor_address                                     = 0x4D,</div><div class="line">   .DEV_configuration_reg                                  = CONFIG_ALL_CH_ENABLED,</div><div class="line">   .DEV_conversion_rate_reg                                = CONVERSION_CONTINIOUS,</div><div class="line">   .DEV_one_shot_reg                                       = ONE_SHOT_DEFAULT,</div><div class="line">   .DEV_mask_reg                                           = MASK_ALL_CH_ALERT_ASSERT,</div><div class="line"> </div><div class="line">   .DEV_CH1_conf.CH_name_opt                               = <span class="stringliteral">&quot;channel1_identifier&quot;</span>,</div><div class="line">   .DEV_CH1_conf.CH_current_sense_resistor_value           = 0.15f,</div><div class="line">   .DEV_CH1_conf.CH_current_sense_sampling_time_reg        = CURRENT_SAMPLE_TIME_2ms5,</div><div class="line">   .DEV_CH1_conf.CH_current_sense_sampling_average_reg     = SAMPLE_AVERAGING_DISABLED,</div><div class="line">   .DEV_CH1_conf.CH_current_sense_FSR_reg                  = CURRENT_SENSE_RANGE_20mV,</div><div class="line">   .DEV_CH1_conf.CH_current_sense_high_limit_reg           = CURRENT_SENSE_HIGH_LIMIT_DEFAULT,</div><div class="line">   .DEV_CH1_conf.CH_current_sense_low_limit_reg            = CURRENT_SENSE_LOW_LIMIT_DEFAULT,</div><div class="line">   .DEV_CH1_conf.CH_source_voltage_sampling_time_reg       = VSRC_SAMPLE_TIME_2ms5,</div><div class="line">   .DEV_CH1_conf.CH_source_voltage_sampling_average_reg    = SAMPLE_AVERAGING_DISABLED,</div><div class="line">   .DEV_CH1_conf.CH_source_voltage_high_limit_reg          = SOURCE_VOLTAGE_HIGH_LIMIT_DEFAULT,</div><div class="line">   .DEV_CH1_conf.CH_source_voltage_low_limit_reg           = SOURCE_VOLTAGE_LOW_LIMIT_DEFAULT,</div><div class="line"> </div><div class="line">   .DEV_CH2_conf.CH_name_opt                               = <span class="stringliteral">&quot;channel2_identifier&quot;</span>,</div><div class="line">   .DEV_CH2_conf.CH_current_sense_resistor_value           = 0.8f,</div><div class="line">   .DEV_CH2_conf.CH_current_sense_sampling_time_reg        = CURRENT_SAMPLE_TIME_2ms5,</div><div class="line">   .DEV_CH2_conf.CH_current_sense_sampling_average_reg     = SAMPLE_AVERAGING_DISABLED,</div><div class="line">   .DEV_CH2_conf.CH_current_sense_FSR_reg                  = CURRENT_SENSE_RANGE_20mV,</div><div class="line">   .DEV_CH2_conf.CH_current_sense_high_limit_reg           = CURRENT_SENSE_HIGH_LIMIT_DEFAULT,</div><div class="line">    .DEV_CH2_conf.CH_current_sense_low_limit_reg            = CURRENT_SENSE_LOW_LIMIT_DEFAULT,</div><div class="line">   .DEV_CH2_conf.CH_source_voltage_sampling_time_reg       = VSRC_SAMPLE_TIME_2ms5,</div><div class="line">   .DEV_CH2_conf.CH_source_voltage_sampling_average_reg    = SAMPLE_AVERAGING_DISABLED,</div><div class="line">   .DEV_CH2_conf.CH_source_voltage_high_limit_reg          = SOURCE_VOLTAGE_HIGH_LIMIT_DEFAULT,</div><div class="line">   .DEV_CH2_conf.CH_source_voltage_low_limit_reg           = SOURCE_VOLTAGE_LOW_LIMIT_DEFAULT,</div><div class="line"> };</div></div><!-- fragment --><h1><a class="anchor" id="sec3"></a>
Initialization process</h1>
<p>The adapter module connects the driver to your application. In order to enable the required bus communication via TWI (or similar) create an instance of the struct <a class="el" href="struct_f_i_e_l_d___b_u_s___i_n_t_e_r_f_a_c_e.html" title="Struct that is used to define bus communication interface. ">FIELD_BUS_INTERFACE</a> and assign its members to the addresses of the bus interface functions. A reference to an implementation of a delay function is also required. Call the function adapter_init_peripherals with the references as parameters in order to initialize the adapter.</p>
<div class="fragment"><div class="line"> <span class="comment">// Instantiate a bus interface </span></div><div class="line"> <span class="keyword">struct </span><a class="code" href="struct_f_i_e_l_d___b_u_s___i_n_t_e_r_f_a_c_e.html">FIELD_BUS_INTERFACE</a> external_bus_interface = {</div><div class="line">    <span class="comment">// Assign i2cmaster library function addresses to members </span></div><div class="line">    .init       = &amp;i2c_init,</div><div class="line">    .stop       = &amp;i2c_stop,</div><div class="line">    .start      = &amp;i2c_start,</div><div class="line">    .repStart   = &amp;i2c_rep_start,</div><div class="line">    .startWait  = &amp;i2c_start_wait,</div><div class="line">    .write      = &amp;i2c_write,</div><div class="line">    .readAck    = &amp;i2c_readAck,</div><div class="line">    .readNak    = &amp;i2c_readNak</div><div class="line">};</div><div class="line"></div><div class="line"> <span class="comment">// Assign user provided delay function to pointer </span></div><div class="line"> <a class="code" href="group__adapter.html#ga87111bfd5f50b4aa1cf9d61f86d4dde6">delay_function_ptr</a> external_delay_function = &amp;<a class="code" href="user__delay_8h.html#adc86d5995b888a6f4ef7dd5647b94f8f">user_delay_ms</a>;</div><div class="line"> </div><div class="line"> <span class="comment">// Initialize the adapter</span></div><div class="line"> <a class="code" href="group__adapter.html#gacc8e6007494e0763460aa21b3fc6f64e">adapter_init_peripherals</a>(&amp;external_bus_interface, external_delay_function);</div></div><!-- fragment --><p>Now the adapter is ready to connect the driver to the application. Call the initialization function for the sensors with a reference to the device struct which was instantiated according to one of the examples.</p>
<div class="fragment"><div class="line"><a class="code" href="group__adapter.html#ga99574463e5985ddbb640f8aee3b1c25b">adapter_init_PAC1720_user_defined</a>(&amp;dev);</div></div><!-- fragment --><p>The return value of the function tells whether the init has succeeded or failed.</p>
<h1><a class="anchor" id="sec4"></a>
Take measurements</h1>
<p>When the sensors was initialized successfully the measurements can be triggered by calling the function adapter_get_measurements_PAC1720 and afterwards the results can be read from the device struct. The function needs to be called with a reference to the device struct.</p>
<div class="fragment"><div class="line"><span class="comment">// Trigger the measurement</span></div><div class="line"><a class="code" href="group__adapter.html#ga56f4b43af759ce48e135da6cd6d8885a">adapter_get_measurements_PAC1720</a>(&amp;dev)</div><div class="line"></div><div class="line"><span class="comment">// Fetch results</span></div><div class="line"><span class="keywordtype">char</span> *name = dev-&gt;<a class="code" href="group__driver.html#gaca1e9392455d02e76179264e5738a129">DEV_CH1_conf</a>.<a class="code" href="group__driver.html#gaf9be1b36f9b47706f73428c89d36bd42">CH_name_opt</a>; </div><div class="line"><span class="keywordtype">float</span> current = dev-&gt;<a class="code" href="group__driver.html#gada1a661d41e52cb0ec773f05a1e0fb82">DEV_CH1_measurements</a>.CURRENT; </div><div class="line"><span class="keywordtype">float</span> voltage = dev-&gt;<a class="code" href="group__driver.html#gada1a661d41e52cb0ec773f05a1e0fb82">DEV_CH1_measurements</a>.SOURCE_VOLTAGE; </div><div class="line"><span class="keywordtype">float</span> power = dev-&gt;<a class="code" href="group__driver.html#gada1a661d41e52cb0ec773f05a1e0fb82">DEV_CH1_measurements</a>.POWER;</div></div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
